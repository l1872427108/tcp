# TCP流量控制
TCP 会将发送的数据放到发送缓存区，将接收的数据放到接收缓存区。

流量控制就是通过接收缓存区的大小，去控制发送端的发送。如果接收缓存区已满就不要继续发送了。

## TCP 滑动窗口
TCP 滑动窗口可以分为：发送窗口和接收窗口。

1. 发送窗口 （包含四部分）
- 已发送且已确认
- 已发送但未确认
- 未发送但可以发送
- 未发送也不可以发送


发送窗口中：有一个发送但未被确认的位置, 还有一个发送的下一个位置。 发送窗口


2. 接收窗口
有这个接收的下一个位置。  接收的窗口大小


## 流量控制
首先双方三次握手，初始化各自的窗口大小，均为 200 个字节。

加入当前发送端给接收端发送 100 个字节，那么此时发送端的  SND.NXT 要右移 100 个字节。可用窗口也就减少了 100 个字节。

100 个字节到达了接收段，被放到接收段的缓存队列中。如果现在由于大量负载的原因，接收端处理不了这么多字节，只是处理了 40 个字节，剩下的 60 个字节被留在了缓冲队列中。


此时的发送端应该少发一点，接收端的接收窗口应该缩小，缩小 60 个字节，由 200个字节变为 140 字节，缓存队列中还有 60 个字节没有被拿走。

接收端会在 ACK 的报文首部带上缩小后的的滑动窗口 140 个字节，发送端对应的调整发送窗口的大小为 140 个字节。

此时对于发送端而言，以及发送且确认的部分增加 40 个字节，SND.UNA 右移 40 个字节，同时发送窗口缩小为 140 个字节。

这就是流量控制的过程。